function [Y,Xf,Af] = HbO2Net(X,~,~)
%HBO2NET neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 11-May-2020 01:37:53.
% 
% [Y] = HbO2Net(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 25xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0.0386235612849487;0.0910581047337421;0.147324167546374;0.176244094479576;0.163450584584949;0.030044496083613;0.0501082292123578;0.0596628782192834;0.062336486970695;0.0574568079181424;0.0202145153746118;0.0254991771971834;0.0274818280671343;0.0275463670277557;0.0265023914530742;0.0147322919911408;0.0170818846128033;0.017757259263922;0.0181539011310964;0.0175639157341983;0.0116169283352427;0.0132530743274665;0.0138137171035451;0.0140089964707299;0.0134320753456578];
x1_step1.gain = [2.47040257577397;2.41483670596826;2.60480816963189;2.69467561084876;2.77714582616469;2.83783652293727;2.81203242028484;2.84649211351007;2.85127328268542;2.89354261133089;3.43721850389179;3.43670902645817;3.44713699384861;3.45591301719788;3.48911369125785;4.22133949531525;4.20912948155941;4.2267943045987;4.1915510618476;4.21959075205072;5.0893581656905;5.10226793801673;5.12281776506954;5.13060263300638;5.07805292673505];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.2601431567432708203;1.2176834201273316616;-0.56574403149035157323;0.81562587361710647826;0.45541404189499484767;0.59950307147467030155;0.261330478662480159;-0.80358896408932933841;0.81119366078200627612;-2.2071072660668606957];
IW1_1 = [-0.41226724299366301896 -0.11714176408466689394 0.28848082130622532127 -0.20387826041565434987 -0.6095837947200503093 -0.49526039815909733699 -0.21730090784136366078 -0.083674604188397880278 0.16405355743196267659 -0.44767051686410880285 0.20670332093896923165 -0.33800024602543526919 -0.46502393621944759783 0.34622057863837102376 0.057528721342186034393 0.43725270857160120075 -0.2576553593347449822 -0.093322621013479614693 -0.33316550801469246856 -0.084653776436010089168 0.1616545534521629246 0.29443113559143796465 -0.025505270193332929551 0.23727102917761189182 0.23050773885751080217;-0.36620039195688841582 -0.024142731098695406622 -0.15949871576592927758 -0.25094731430414723983 0.25020954741112200193 0.13006386728093727312 -0.12293486086509987365 -0.32113502716734454445 -0.32502807929692806299 0.39755307189732863593 -0.26597636674485630737 0.19314562581448491141 0.30778600027102021031 0.16742707004297496809 0.32357812255542439672 -0.038588164115429118839 -0.43429479945451948675 0.10715325690435523187 0.14929783226951579 0.033893679252988646866 0.5581260519683819421 0.14805786149299152155 -0.28535915013769241888 0.445720624837233792 -0.13913499301108187001;0.20845650833844051042 -0.31283156023094244036 -0.055643962925810752651 0.027690256817678587931 0.13419998129103108409 0.33357025560073289006 -0.26489720609421990583 -0.20163751241745703213 0.21301678079628771911 0.22278224596498405474 0.46407042743481446978 -0.43088625459322404954 0.24997596591162130064 0.40659330544790256434 -0.25141348627796522575 0.33132700011177490529 0.060209345140759269743 0.25038173157956711279 -0.41275059772814426395 0.30429607439401928914 0.062384097530816293165 -0.58953721225885313828 -0.17666646275023589752 -0.32630800178526592203 0.42713920646872000075;-0.12437689054447256809 0.26912271706832130436 0.15318707906436646038 -0.092043106620797482398 -1.2534243109686442619 -0.12640440076089082266 0.36559411430537341881 0.18254993826603230223 0.40983942406582024587 0.20799592160259308682 -0.026640385919690368066 0.050494963875090705108 0.13541126730815544743 0.29653773551641038342 0.70852635397764518466 -0.24450354803953697203 -0.15467578703519838101 0.019439735190442841706 0.10647165047305083563 0.37484911290336886402 -0.20754938566103003916 -0.076894111307985901771 0.035501737583304909807 -0.30726852666874548969 0.6050205402458167514;-0.304400013881677034 0.061426876913984913842 0.25255205964884264169 0.42161519946841669038 0.5974387371061057328 -0.026499921631215180018 0.14409050800801936898 -0.16465186095416595169 -0.20125478950617187168 0.71931222257446780777 0.40650979157505184869 -0.079694581343667900142 -0.15285023219655291538 -0.069793494524284044322 -0.0028000908768362978846 -0.20137860269880761277 -0.35754341383295717982 -0.27546617376873072658 -0.33361835334624001526 -0.35817058057342565647 0.45717785288434459323 0.62837540737904207244 -0.26947129191172103369 0.056702583293865432834 -0.3085259629452886676;0.10636390886563693026 -0.13841010586891189238 -0.37830384246024767458 -0.24082896330138098273 0.046931250562994304698 0.10263508311290613084 -0.30377370002980430552 0.089475826363649230144 0.1102157359526643593 1.0446553453676807877 -0.5083868504154700485 0.1739769947936796457 -0.22102605955538931481 0.090651608854257076375 0.52691294948824274336 0.52541204770761107401 0.28534587713261500008 0.00038663200159012303322 0.25401148256458322416 -0.38341131050809118541 0.097849951582591715438 0.073139965746744500796 -0.51730397695875718345 -0.28334623718985990637 0.018868697185557385676;0.14296054364073429443 -0.20718809202294244387 0.14799933558353228769 0.035911642252585654345 0.42894305133759069726 -0.25691211982209055664 -0.53791652509462162257 0.092439587972612952127 0.057296225481503350319 0.67935555912176381899 0.15608409740742010263 -0.097812957198182143292 0.34090473790216035965 0.22760787718979427763 0.07389147041166005403 -0.42934200730290539294 -0.025612320571198769759 0.11654631700973712427 0.51086035544068597591 0.3354065158218234588 0.14135249400717134205 -0.31197173125485572198 0.28896649166372334605 -0.32111223961177176589 -0.68435545569319600201;-0.34661941031794674117 -0.42183004171897037216 -0.62313955630694006782 -0.50735701920839682 0.75474349886469194182 0.0042840308860963086102 -0.079165478026731295191 -0.059925841611331964742 0.33910022623169061573 0.47542932049923031235 0.26443477728309677799 -0.071282143435226985595 0.14057715402889645051 0.05921504120651283759 0.2450437508045501811 0.2866673461040569193 -0.18537963775925034304 -0.013801800517662806203 0.13757234168082244086 -0.42644305897775391934 -0.0066400569823065998601 0.35574074370579683579 0.23613613477539965868 -0.15950083435901912798 -0.37352379086855402868;0.20130181365805779881 -0.1598955138454115632 0.53237693671279517904 0.53103864396420530358 0.12577684306360598088 -0.18659227157477950576 -0.13476139074129606099 -0.16440546632403107985 -0.36720173959974733435 -0.38597881539497885806 -0.30667146215041440893 -0.12916859556523913044 -0.62376544639827657956 -0.30895373715006702042 0.23109995630430490987 -0.031607306117511502208 -0.062135554900114284282 -0.13583814262431134767 -0.31279080201524889215 0.31363482856208568794 0.40353177301602688454 -0.1862822674466445283 0.076662229967298614608 0.46986372314052377019 -0.092856827867223767914;-0.47131419463569373951 0.045558185305838515278 -0.11572395868692239573 -0.10560358268963916661 0.018446820024734709997 0.061909377729299913673 -0.35493570601053203717 -0.00021321060188768913013 -0.27371967317570888856 0.4972961405728375528 0.24178859900615448653 -0.27158512678364604698 -0.077781115637639272609 -0.048479556821662800337 0.079498062231779742515 -0.63461470096969774257 -0.0040895569480979233543 -0.18451375266114161677 0.027978499723487995632 0.75996415878923073706 -0.43534441168958010193 -0.30912340400342158686 -0.15275873077476959105 -0.023548666551083695386 0.074066247124623438292];

% Layer 2
b2 = [1.7336721963354904119;-1.4111281187920718949;-0.87857211646704092001;0.73715965734842525681;-0.44281714041468206444;-0.084392089679603293773;-0.86547315820826975497;-1.0542377462158574186;1.3286524154510486184;-1.983443068476719251];
LW2_1 = [-0.72625094337882334372 0.63097774894627112197 -0.67416925751315126547 0.32320245708826422781 0.82187740841426881744 0.12500832370014183792 -0.24306660254823306277 0.69115785572479515597 0.62586922321478621889 0.0064261369718721329455;0.63338921615900534157 0.57864198465554084194 0.67135776643352762516 0.21686100562982371653 0.57700871543801390828 -0.4265441159471792254 -0.30118166881624763853 0.73872377700565905467 -0.72969439400823066233 0.39069613978988415592;0.23252357606687243385 -0.5259198406226742728 0.15568122872490353092 0.22364690683162757878 0.78985560240929231224 0.42639039842609072206 0.93690531949910582643 0.69452225214834506506 0.35772203881016012561 0.47191949520752013436;-0.59460610030170069074 -0.15759229137098712537 0.26858581745091375526 -0.81770447050008654433 0.84354765964675026968 -0.51572748391358314013 0.16775439212005413547 1.0782481859765811194 0.30353382028277359206 -0.8844675219227191576;0.46979364180745836199 0.47415094934955376305 -0.69218202874276368863 0.37938378974749104033 -0.84536919756239436996 -0.88330137596307201076 -0.14061022655485017063 -0.41153672980249234037 -0.38709418931011801979 0.64000927907199856026;-0.64782433401420214114 0.67690567844260041142 -0.2927979841247781434 -0.65957541694779109331 0.21317769220737331493 -0.41278644150139848223 -0.21173194696542760318 0.39167075748847418604 0.71837523203152919837 -0.74611980985509374076;-0.30144264614776344891 0.40630626552524878869 -0.23430139103628175312 -1.2517695702616562503 -0.85088447178575044028 -0.91226055347016743458 -0.15556379369337530738 1.4614823927906694934 0.45630477385791057277 -0.7827389219162196321;-0.40906156370972379666 -0.86491927940733437374 -0.14081658962036100458 -0.70226715825345620292 -0.17133769292797976225 0.50981723467943551587 -0.75040021864261641227 -0.0066936254959907171697 0.82441532833934727531 0.5116826592688815678;0.19593210700570340421 -0.39442894911185560902 -0.63198221440251189929 0.049547686486404937667 1.0732469868920591072 -0.75397115788031299211 -0.45211044644679110327 -1.0578222161893231501 -0.82839570197406442453 0.27049706233633408203;-0.55824904148925791336 -0.5132241067924019351 -0.33548203030195666852 -0.80485306001492962213 0.13348515980017858218 0.58415968193315537249 -0.68971637878402536348 -0.22147880821722415456 0.64796329028307175779 0.36785929749576246062];

% Layer 3
b3 = [-1.8368532231498106988;1.4144985313983928776;-0.91048444268891848274;-0.63121605944778436115;-0.24233168835897678228;-0.27681804096513157321;0.57553885092788126254;0.91967776977404613881;-1.3698038223051816065;-1.7618915155727099542];
LW3_2 = [0.50525491346696693729 0.7648835173166814716 0.24386719354917515967 -0.69483944308688438962 0.50026671782408538292 -0.25507245487913215998 -0.85295081557727758792 0.11503655510693371056 0.44997458571873766298 0.66679611902077418062;-0.71833098386185434414 0.72784727500490309371 -0.74119930261564248575 -0.81825527404803277687 0.075938814565740184181 -0.60741460699344929086 -0.7160387581845265581 -0.2704196226341907261 -0.18297322587760345147 0.2878693458502035174;0.3866967588590206617 0.010291486608994402513 -0.93081105164649136086 0.2576982528277744211 1.149224905483240633 -0.97097403311045749064 -0.90075218199574635936 -0.063587580360791776113 0.44541763066972861473 0.11856829469121507592;0.55387798850998692934 0.80179111066364805449 -0.6713713096725127949 0.093073162940768547347 0.56345944838533323917 0.61400624956650351471 -0.26831407171493054653 0.40170232996381960433 0.21424211723530861562 0.87936986097845160071;0.49523733433961802941 -0.41326645885471530173 0.27839042154555593278 0.81909120891075570814 0.40902055203648890469 0.69050432340198841796 0.61108138149345880841 -0.22244534933006671062 0.58340776437673369514 0.7957113985621111496;-0.64652669138836282858 -0.38667521276704686084 -0.38808343004815892829 -0.88530109366516551717 0.47878785468578333173 0.67446489442239165868 -0.63419642501114736888 -0.4892008369197482498 0.15066860418906891095 -0.43003700209420964162;0.34682859118464171022 -0.74758130161057800844 -0.23203868772876329318 0.95192454907930823538 -0.84345533889761781232 -0.5517921563009033914 1.2278653401202757056 0.21175535561993946709 -1.0552308479302401345 -0.29313790792621452486;0.25706759021616248928 -0.086006820162154815068 0.49003782749161622911 -0.34386989507435011815 -0.92899464905072171028 0.70749174253298274806 -1.5148416562063959923 0.36882603905751049078 -0.090331598228832882258 0.49349379698445389186;-0.12303734736240913572 0.52254727768959119416 0.55980093765902028125 -0.12211196900615244043 -0.34101887821442761206 -0.63263783013080432394 0.055764517160830230635 0.67603917944445401922 -0.37036474907582817018 1.1709906266336200797;-0.25487780349212013631 0.83826598810842556375 -0.011739060424059654525 -0.89453527445366320947 -0.53711038225623930487 -0.23587272109909207529 -0.54606591302173612679 0.089537594249654711698 -0.77273305999975061553 0.53605006341728389518];

% Layer 4
b4 = -0.65445094157311400895;
LW4_3 = [-0.68552874931632445943 0.30707564856617669546 0.95954117849607034607 0.39668529537253155448 0.37029718089976626505 -0.76601154324995646139 -1.620380119602238933 0.87338355652150867492 -0.59292120129715863985 0.24588257959277476372];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 21.5723531737148;
y1_step1.xoffset = 0.00728864351110358;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = repmat(b4,1,Q) + LW4_3*a3;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a4,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(4,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
