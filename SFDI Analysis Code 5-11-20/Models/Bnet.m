function [Y,Xf,Af] = Bnet(X,~,~)
%BNET neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 11-May-2020 01:30:46.
% 
% [Y] = Bnet(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 25xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0.0388354200852612;0.0911567731099437;0.147871908267476;0.178424177186843;0.163694823510126;0.0301721412506134;0.0503267837195143;0.059506621607474;0.0624421522657435;0.0567574143734161;0.0202672764824055;0.025534967095644;0.0275667302070603;0.0277671256079575;0.0264701784961533;0.0145936908289328;0.0173435242156755;0.018228898192339;0.0183684137751468;0.0176934507922806;0.011638612663122;0.0131384501139124;0.0138582593981408;0.0140082437612068;0.0134843984238551];
x1_step1.gain = [2.46224202755392;2.4506125854125;2.59960866233476;2.67894812024082;2.78734666534396;2.8089009029759;2.83804634596332;2.84542864012105;2.86832533370805;2.8969546976401;3.43563857454329;3.4421936075049;3.42830029682757;3.42800021325925;3.48480915882123;4.19723231276319;4.17854560396455;4.23314594084516;4.22652023647353;4.2241607768925;5.10007631387838;5.06976182025794;5.12415774609363;5.05846273536661;5.12836344275366];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.17436415316665215824;-0.28670083832375231614;0.57707622886881038138;0.23336212840029540994;-0.56750905943449458935;-0.9970253088931305685;-0.34221596505776874508;-0.12342283838791107131;0.11319031522059029571;-0.62022855887894212668];
IW1_1 = [-0.10893279571004252371 0.086978629411018068551 0.25969617004767253654 0.24662331208066137767 0.13433494946649754409 -0.014936756945771428873 0.27379818830447422151 0.3246085557551359746 0.33983830592316377484 0.07389363803860525548 -0.11095470332306454908 0.042978299533303239433 -0.018333251661329166837 -0.015296551052797743853 0.081106700199541525986 -0.27463695913262248238 -0.20463427922947119431 -0.22812208663557381749 -0.11754559285244374489 0.36205781547413173893 -0.43131566615259531172 -0.41237902009301163897 -0.32874875406407244594 -0.16805468734044745616 0.54230960825891838528;0.92383820197853128153 0.18080860369048598613 -0.18519570309211855208 -0.27198702001952523855 0.06344413527621509119 0.63571044210609228831 0.0690501705742844335 -0.37967766619088716418 -0.72533156355230277157 -1.6407375794396965585 0.43964240462394077458 0.12611344095152246525 -0.11185501989234535036 -0.54374785392752544855 -0.70747139699383165823 0.64229695978863088346 0.19230066207994200855 -0.058528593667038705806 -0.24976863579520758307 -0.20791985810268542867 0.6584400861762919055 0.2254669128089709651 0.053320681118504492657 -0.052524224209968571608 -0.034879950028930642447;0.30211880284389863727 0.84042805270220810598 0.23773335276916307546 -0.0032217173967684156755 -0.28707823408787452868 0.44810851646277011229 0.40274292631638092255 -0.066321541364039560129 -0.43925518854146894387 -0.99692953902682024392 0.45315129371656343027 -0.025712385359982839472 -0.552581095956226509 -0.25679044112951066037 -0.26879530007884877563 0.215337435062510546 -0.055949324418183843388 0.10533073454741165298 -0.2806621139415645394 0.2040696122387374023 -0.082179648185362413892 -0.050110454044757099523 -0.089337543534386304467 -0.24525288190482472106 0.27603678018126420746;-0.79143115989718382242 0.1441283656419044823 0.52550074475334873636 0.74451341705824936046 -0.062836136138559317565 -0.75861065362408797164 -0.14828429107091922745 0.35255131127678335234 0.67386664947879537646 1.2339134168432817074 -0.28835701681581549227 -0.10811913172574384723 -0.18045877842700014382 0.59621079927901021733 -0.13274389682127282764 -0.49852012638861070704 0.047786015165421961981 0.39921673699314036421 0.19707160500007939175 -0.49818634004397144288 -0.61284691340915975477 -0.031510807088656167529 0.22712671185810875962 0.053748333140825776955 -0.61334037258596529885;0.19144653720117185691 0.085723324416178914298 -0.051200601403591790295 -0.14901175712111147664 -0.037975422741444261887 0.13548721846541689207 -0.17292314545428227879 -0.3089671627330685677 -0.3951371146647196797 -0.77315207139608410625 0.22100990998180083946 -0.0012018798706048532815 -0.13905006035985179036 -0.30324543826701066962 -0.63681272555197554475 0.46484971458539864342 0.23931538376793581868 0.041748363724434231492 -0.086435110573565274161 -0.36464522989772357731 0.73209593815979745468 0.44321445990113422786 0.30292738137108643492 0.12073856591806798877 -0.11979433106992105895;2.0962600763538263848 -0.060599107606640993662 -1.467615144323511478 -1.2815026835484364387 0.22677820870127934905 1.119660638238042738 -0.056232892314464093253 -0.43876286990279061984 -1.2847483959575947132 -3.0198707788397589624 1.113065587778668375 0.44921878448791557892 0.198348195240283659 -0.42373128523703257331 -1.1033656951326293871 1.2606101856124996008 0.63999450704149873914 0.38531844724859359852 -0.065566071345426829575 -0.49368806921540409061 1.1779444574780393307 0.61239470734761047854 0.41931212656452337972 0.097786824403971586706 -0.45219299913098986998;-0.17499684336201973278 0.031992843655626844457 0.15462024266193119537 0.055049416376935313144 0.0075401785244713663212 -0.31528528397794181037 -0.46409384143442411474 -0.77353685327226084922 -0.29378269534435946797 1.005958803462095652 -0.51358863110228925031 -0.54533661830625956846 -0.43790764833280049206 -0.19711443291952510104 0.97225013238278079619 -0.28595538851486451692 -0.35223210707352886617 -0.16413840728820489057 0.098619604036901065136 1.1733893031973328114 -0.27830268047914996643 -0.22939633358539407437 -0.0540400135195890155 0.289292004496095434 1.1740285406725576856;-0.3518664394481569313 -0.29911786204492568642 0.088954202043992874893 -0.069126708528464086978 0.078564399605557444506 0.22500168321745431244 0.35638698776248511901 0.28413868282547460886 0.294251366464511388 0.12489265086097238455 0.26368493016080918334 0.19706554228357248126 0.060432854362735322074 -0.13769660135046574156 -0.65695438438497233413 0.30811749247178255029 0.14381309332625341613 -0.0089500822296084154434 -0.16185354253509043332 -0.66273323204507872397 0.3572224120698587746 0.21521627039656576752 0.029936350768833375896 -0.10394828018275979742 -0.5470979180835956468;0.29755848424808861719 -0.00068855993413115333494 -0.21561557405656653352 -0.31302498401641337678 0.14207810730593051218 0.27977181028994679846 -0.054016254710549188589 -0.24326726862803374485 -0.34774247013930303929 -0.58226190737186866997 0.21459564221900448433 0.11472866206437927483 0.078340065444801168515 -0.066795386095261796711 -0.022291408640922091844 0.27472368101631000625 0.15820516203554044199 0.058859875405404271653 0.078859821313870509529 0.083295038883744898506 0.34738497836501153193 0.20915237983520970633 0.1459542299405500454 0.10083420963664495307 0.098870369538238203622;0.12795956123862592402 0.080362279789327070723 0.11220396165790680332 -0.11021824737926280702 -0.57854696125360227654 0.10309210416361054563 0.097282643778375491039 0.053093963745152225608 0.031339321552892554501 -0.1768931266049269535 -0.029298376140492802394 0.13136393931715464878 0.15898207437295006073 -0.038783639982180109773 -0.20923701152944043646 0.0060522717601040557783 0.11863032772122659997 -0.050383143896749485457 0.053971570895596419903 -0.025267726140677803509 0.077070223851831348716 0.072609961855000612618 0.051659946153353654419 0.13356097486617021786 0.23831272972880693239];

% Layer 2
b2 = [0.33822471447799606903;0.5223288249549379314;-0.062125615992181915104;-0.7334100319302283566;-0.41018225809781322377;0.37431280445250630917;0.090381036911019577151;0.12201681032312039488;-0.41849265415522185485;0.36667855898770662648];
LW2_1 = [-0.16546390101088143121 -0.37152953868288624006 -0.089230109381308139738 0.24871688483842133155 0.43876138667425013118 -0.060219232522175203393 -0.65995175127916261282 0.15373281074378586375 0.20101725738046261061 -0.11804923594081931371;-0.61142287908778103489 0.20023636729046723204 0.54562817382756534368 -0.69822590174855880818 0.19339702004557748904 -0.44956837867420207377 -0.10368265103290838502 0.054281742190521203861 -0.27783508848683213799 -0.52889239931517295634;0.29565719225436115636 0.12382389273006499941 -0.10919927384668524917 1.4758088732068657123 -0.69894295481225754418 0.45191510257404748918 0.39006624996882510725 -0.50593338741168580874 1.2063575082164361696 0.30604002138138136635;-0.12306389200977900511 0.14401848149938481503 -0.26112636611791228969 -0.077356797863386478342 0.48852485568877784816 0.18107082496886325873 -0.75164350288411307943 0.23877123321152840529 -0.65403803918824887642 -0.13476117121168493251;0.28128029720809055725 -0.030105074640164517646 -0.38600619730039104072 -0.46083979015773968158 0.81561154238124400351 -0.24070756174035859432 -0.1143260675589586467 0.31523460662750429906 0.48978192170769974112 0.43191933242461350018;0.17325661612480286466 0.41648597548063426288 -0.40035301521630312083 0.60936614647840137149 0.57590592358684289387 0.45271390021052781982 -0.6438369386223802282 -0.49581356061730841311 0.65346883664490584831 -0.20740314666879600125;-0.80612089490468352704 -0.0043412434810781554487 -0.96011973089998781106 0.25294838507546152373 -0.26397156673281346739 0.33747339549746130372 0.36564257997050442217 -0.15342857254013900214 0.24907509301755212383 0.2413818310847586357;0.023312197979820741683 -0.46393498943258615341 0.37500334450328065561 0.35116032513313427676 -0.82211860542452674938 0.20920913864856618969 -0.76662795269188643843 0.21258719353397978469 0.37316819506693266195 0.36920828638001895738;0.36922682687131286317 -0.20613325571509266698 -0.36965758969668505163 0.073890293696249192967 0.21548068275740822619 -0.031508555480726466169 -0.75681241473968308142 -0.47557779260413912681 -0.031557123198886302684 0.32894109444096875094;-0.010199512027068480258 0.15815401737641468505 0.079630849346853202486 -0.134082321498544349 1.1094306915242808653 0.37655530604994413846 -0.13914774620309430797 -0.54150648112576527105 0.1021459291318067425 -0.17750162771142530271];

% Layer 3
b3 = [0.1031267538682380247;-0.29367831581599229684;-0.37798363447734395493;0.0957475980252222858;0.60544122894614293973;0.40356353387850751879;0.16282084451857592455;0.0049104795029117284666;-0.015762395407507054368;-0.45920434218848077412];
LW3_2 = [-0.20296236461136671347 -0.064223955336125335136 -0.12572265589990821999 -0.32569149893222909542 -0.10178522016929958394 0.00045745067020477219247 -0.2363531107066103587 0.072010679153501358507 0.11047695923517360239 0.072563844807079974641;-0.24180267055047904856 0.043671411455839415083 0.17346424912562077858 0.29509224217686058633 -0.18805567648988316676 -0.42318884597347483645 0.019322253416914701718 0.1546863385111168776 0.34520047380257395941 -0.021602414647473193454;-0.97390014565847338179 0.23043173525312243832 -0.043607560725599632534 -0.60105037971978825251 -0.40048783188256126264 -0.24942830392857251454 -0.060946513577575162079 0.85976577067392745413 0.070890093715439750355 0.64103701313643335347;-0.27241131894509662548 0.70618513163542206978 0.060314474888664593166 -0.28423164267049522147 -0.32671237684366721821 -0.4176073491136719773 0.067148443022000736669 -0.38545115690363146443 -0.525434473615294384 0.26972059681496290962;0.35267922923775446575 0.2094073542435266333 0.017469334908414860252 -0.99358049456973496216 0.036762236447335359946 -0.52760693217492138363 0.28180589568949843127 0.51044963581374980244 -0.17943342215055366196 -0.09627769792325323317;0.093629266755919787757 0.019193295090804505382 0.079913380495383226632 -0.4484800953505412302 0.90244888000075784706 -0.46322979258972962757 -0.23063150874606616614 -0.22378807499677977333 0.042619312000436289367 0.29910313208719097045;0.64461657241799708018 0.74350884291581287311 -0.64992403317443736555 -0.16005377248195321038 -0.41640111438114929543 0.32215173472253721965 0.56666281149834041297 -0.32090959430407445252 0.18734938505965931244 -0.35354244870299089687;0.52827747888111287189 0.44264882264965077496 0.1140560371432235709 0.55482282947178651611 -0.29057557432596231584 0.31519671142017530174 0.0054620881773756327707 0.43683646418356897323 -0.063498840086070595934 0.0012663734234045894919;0.11080474242435180143 -0.31621970183359887629 0.59570571430357377452 0.053711850814640263452 -0.50773826131046240207 0.15564526689509008972 0.31853737202222981439 0.83889607823307255074 -0.21703555134525318038 0.14679658630552408494;-0.52418937065710780043 0.19809376530429964602 0.070883829068810660923 -0.1366255414130303214 0.270519882231695874 -0.70536960080614474755 -0.17777161273980768286 -0.33392931510757173363 0.34631868707517948769 0.25969144671971772231];

% Layer 4
b4 = -0.4271485319822030946;
LW4_3 = [-0.58182018395990575677 0.15379953347889643855 -1.5336031215442007536 1.0399304094239349983 -0.96242001654155973078 -0.37899642594940341489 -0.54585607359172594322 0.88523072848982042871 0.058542030112204421211 -0.52356633175543187964];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.500029159832885;
y1_step1.xoffset = 0.000142755864194211;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = tansig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Layer 3
    a3 = tansig_apply(repmat(b3,1,Q) + LW3_2*a2);
    
    % Layer 4
    a4 = repmat(b4,1,Q) + LW4_3*a3;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a4,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(4,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
